<!-- Based on the example by  http://processingjs.org/learning/ -->

<html>
<head>
<script type='text/javascript' src='http://code.jquery.com/jquery-1.6.2.js'></script>
<script src="processing.js"></script>

<script>
    //Declare a global value to use later in a processing.js script      
    var rotation = 1;

    $(document).ready(function(){ 
       //subscribe the large display application to the clock topic
       $.ajax({ type: "GET", url: "subscribe.php"});

       //retreive events every second and parse them.
       setInterval(function () {
         $.ajax({ type: "GET", url: "getevent.php", dataType: "xml", success: messageParser });
       }, 1500);
    });

    function messageParser(xml) {
      //for each event received by the broker we will add 5 "seconds" to our counter.
      $(xml).find("event").each(function () {	  
        rotation = rotation + 5;
        //we are doing a "clock" so only allow rotation to be up to 60 "seconds"  
        if (rotation > 61) {
	  rotation = 1;
	}
      });
    }
</script>

</head>
<body>
<h2>Simple Large Display Interaction.</h2>
<p>Add 5 seconds to our "counter" for each swipe on our web-mobile app.</p>
<p><canvas id="canvas1" width="500" height="500"></canvas></p>

<script id="script1" type="text/javascript">

// Simple way to attach js code to the canvas is by using a function
function sketchProc(processing) {
  // Override draw function, by default it will be called 60 times per second
  processing.draw = function() {
    // determine center and max clock arm length
    var centerX = processing.width / 2, centerY = processing.height / 2;
    var maxArmLength = Math.min(centerX, centerY);

    function drawArm(position, lengthScale, weight) {      
      processing.strokeWeight(weight);
      processing.line(centerX, centerY, 
        centerX + Math.sin(position * 2 * Math.PI) * lengthScale * maxArmLength,
        centerY - Math.cos(position * 2 * Math.PI) * lengthScale * maxArmLength);
    }

    // erase background
    processing.background(224);

    // Moving hour arm by second increments
    var secondsPosition = rotation/60;
    drawArm(secondsPosition, 0.90, 1);
  };
  
}

var canvas = document.getElementById("canvas1");
// attaching the sketchProc function to the canvas
var p = new Processing(canvas, sketchProc);
// p.exit(); to detach it
</script>

</body>
</html>
